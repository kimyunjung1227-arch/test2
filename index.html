<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NowTrip - ë¯¸ë¦¬ë³´ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .phone-frame {
            width: 375px;
            height: 812px;
            background: white;
            border-radius: 40px;
            padding: 20px 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            padding-top: 10px;
        }
        
        .logo {
            font-size: 32px;
            font-weight: bold;
            color: #000;
        }
        
        .search-bar {
            margin: 0 20px 20px 20px;
            background: #F5F5F5;
            border-radius: 25px;
            padding: 15px;
            display: flex;
            align-items: center;
        }
        
        .search-icon {
            margin-right: 10px;
            font-size: 18px;
        }
        
        .search-text {
            font-size: 16px;
            color: #999;
        }
        
        .collage-container {
            padding: 0 20px;
            flex: 1;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 400;
            color: #000;
            margin-bottom: 15px;
        }
        
        .collage-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .image-wrapper {
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 1;
            position: relative;
        }
        
        .image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #fff;
            border-radius: 12px;
        }
        
        .bottom-nav {
            height: 70px;
            display: flex;
            background: white;
            border-top: 1px solid #E0E0E0;
            padding: 8px 10px 10px 10px;
            justify-content: space-around;
            align-items: center;
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            z-index: 10;
        }
        
        .content-scroll {
            height: 100%;
            overflow-y: auto;
            padding-bottom: 110px; /* í•˜ë‹¨ë°” ë†’ì´ë§Œí¼ ì—¬ë°± */
        }
        
        .nav-button {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .nav-button svg { width: 24px; height: 24px; margin-bottom: 4px; }
        .nav-button, .upload-button { color: #9aa0a6; transition: transform .15s ease, color .15s ease; }
        .nav-button.active { color: #FF3B30; transform: scale(1.1); }
        .upload-button.active { transform: scale(1.1); }
        
        .nav-text {
            font-size: 12px;
            color: #000;
        }
        
        .upload-button {
            width: 50px;
            height: 50px;
            border-radius: 25px;
            background: #FF3B30;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            cursor: pointer;
        }
        
        .upload-icon {
            font-size: 24px;
            color: white;
            font-weight: bold;
        }
        /* Screens */
        .screen { display: none; height: calc(100% - 90px); overflow-y: auto; padding-bottom: 110px; }
        .screen.active { display: block; }

        .trending-header { padding: 10px 20px 0 20px; }
        .logo-small { font-size: 20px; font-weight: 700; }

        .mosaic-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 10px 10px 90px 10px; }
        .mosaic-item { width: 100%; aspect-ratio: 1; overflow: hidden; border-radius: 10px; }
        .mosaic-item img { width: 100%; height: 100%; object-fit: contain; background: #fff; display: block; }
        .time-badge { position: absolute; left: 6px; bottom: 6px; background: rgba(0,0,0,.6); color: #fff; font-size: 11px; padding: 2px 6px; border-radius: 10px; }
        .update-indicator { display:flex; align-items:center; justify-content:center; margin: -6px 0 10px 0; }
        .dot { width:8px; height:8px; border-radius:4px; background:#34C759; margin-right:8px; animation: pulse 1.8s ease-in-out infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: .9;} 50% { transform: scale(1.4); opacity: .5;} 100% { transform: scale(1); opacity: .9;} }

        /* Search screen */
        .search-header { padding: 10px 20px 0 20px; }
        .search-input { margin: 10px 20px; background: #ECECEC; border-radius: 25px; padding: 12px 16px; display: flex; align-items: center; }
        .search-input input { border: none; outline: none; background: transparent; width: 100%; font-size: 16px; }
        .cards-row { display: flex; gap: 12px; padding: 0 20px; overflow-x: auto; }
        .card { width: 110px; flex: 0 0 auto; }
        .card .thumb { width: 110px; height: 80px; border-radius: 12px; overflow: hidden; background: #ddd; }
        .card .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .card .label { background: #fff; padding: 6px 0; border-radius: 10px; margin-top: 6px; text-align: center; border: 1px solid #EEE; }
        .chips { display: flex; flex-wrap: wrap; gap: 8px; padding: 0 20px 20px 20px; }
        .chip { background: #fff; border: 1px solid #EEE; padding: 8px 12px; border-radius: 12px; font-size: 14px; }

        /* Region screen */
        .region-header { padding: 10px 20px 0 20px; display: flex; align-items: center; gap: 12px; }
        .back-btn { padding: 8px; cursor: pointer; }
        .badge-row { display: flex; gap: 10px; padding: 10px 20px 0 20px; justify-content: center; }
        .badge { background: #EFEFEF; padding: 8px 12px; border-radius: 12px; display: inline-flex; align-items: center; gap: 6px; }
        .region-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 14px 20px 110px 20px; }
        .region-item { width: 100%; aspect-ratio: 1; overflow: hidden; border-radius: 12px; }
        .region-item img { width: 100%; height: 100%; object-fit: contain; background: #fff; display: block; }

        /* Upload screen */
        .upload-header { padding: 10px 20px 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .plus-btn { background: #FF3B30; width: 36px; height: 36px; border-radius: 18px; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 22px; cursor: pointer; }
        .photo-box { margin: 14px 20px 0 20px; width: calc(100% - 40px); aspect-ratio: 16/9; border-radius: 14px; background: #F0F0F0; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .photo-box img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .field { margin: 14px 20px 0 20px; }
        .field-title { font-size: 16px; margin-bottom: 8px; }
        .input-box { background: #F5F5F5; border-radius: 12px; padding: 12px 14px; }
        .input-box input, .input-box textarea { width: 100%; border: none; outline: none; background: transparent; font-size: 16px; }
        .upload-cta { margin: 14px 20px 120px 20px; background: #FF7A1A; color: #fff; border: none; border-radius: 12px; padding: 14px; font-size: 16px; cursor: pointer; }
        .picker-sheet { position: fixed; left: 0; right: 0; bottom: 0; padding: 16px; }
        .picker-sheet .card { background: #fff; border-radius: 12px; overflow: hidden; }
        .picker-sheet .btn { padding: 16px; text-align: center; cursor: pointer; }
        .picker-sheet .sep { height: 1px; background: #EEE; }

        /* Map screen */
        /* ì§€ë„ í™”ë©´: ë¡œê³ (ìƒíƒœë°” ë°”ë¡œ ì•„ë˜) â†’ ê²€ìƒ‰ì°½ â†’ ì§€ë„ */
        #screen-map.screen { position: relative; height: calc(100% - 90px); padding-bottom: 0; }
        .map-header { position:absolute; top:10px; left:20px; right:20px; z-index:2; padding:0; }
        .map-search { position:absolute; top:48px; left:20px; right:20px; z-index:2; background: #ECECEC; border-radius: 25px; padding: 12px 16px; }
        .map-search input { width: 100%; border: none; outline: none; background: transparent; font-size: 16px; }
        /* ì§€ë„ëŠ” ê²€ìƒ‰ì°½ ì•„ë˜ë¶€í„° ì‹œì‘, í•˜ë‹¨ë°” ìœ„ê¹Œì§€ë§Œ í‘œì‹œ */
        .map-canvas { position: absolute; top: 100px; left: 0; right: 0; bottom: 0; overflow: hidden; }
        .map-bg { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
        .pin { position: absolute; width: 54px; height: 54px; border-radius: 12px; overflow: hidden; border: 2px solid #fff; box-shadow: 0 2px 6px rgba(0,0,0,.2); transform: translate(-27px, -27px); }
        .pin img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .pin.active { border-color: #FF7A1A; border-width: 3px; }
        /* ì§€ë„ ì¸ì•± ê²€ìƒ‰ íŒì—… */
        .map-popup-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.35); display: none; z-index: 20; }
        .map-popup { background:#fff; border-radius:16px; padding:16px; width: calc(100% - 40px); max-width: 360px; margin: 80px auto 0 auto; }
        .map-popup .title { font-size:16px; font-weight:700; margin-bottom:8px; }
        .map-popup .input { background:#F3F3F3; border-radius:12px; padding:10px 12px; margin-bottom:10px; }
        .map-popup .input input { width:100%; border:none; outline:none; background:transparent; font-size:16px; }
        .map-popup .chips { display:flex; flex-wrap:wrap; gap:8px; }
        .map-popup .chip { background:#fff; border:1px solid #EEE; padding:8px 10px; border-radius:12px; font-size:14px; cursor:pointer; }
        .map-popup .footer { display:flex; justify-content:flex-end; margin-top:6px; }
        .map-popup .footer button { background:none; border:none; color:#FF3B30; padding:10px 12px; cursor:pointer; }

        /* í•€ ìƒì„¸ íŒì—… */
        .pin-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.35); display: none; z-index: 21; }
        .pin-popup { background:#fff; border-radius:16px; overflow:hidden; width: calc(100% - 40px); max-width: 360px; margin: 80px auto 0 auto; }
        .pin-popup .thumb { width:100%; aspect-ratio:1.6; background:#000; }
        .pin-popup .thumb img { width:100%; height:100%; object-fit:cover; display:block; }
        .pin-popup .body { padding:16px; }
        .pin-popup .chips { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
        .pin-popup .chip { background:#F1F1F1; border-radius:12px; padding:6px 10px; font-size:14px; }
        .pin-popup .cta { padding: 0 16px 16px 16px; }
        .pin-popup .cta button { width:100%; background:#FF7A1A; color:#fff; border:none; border-radius:12px; padding:12px; font-size:16px; font-weight:600; cursor:pointer; }

        /* ì§€ë„ ë“œë˜ê·¸ ê°€ëŠ¥ ë°”í…€ì‹œíŠ¸ */
        .map-sheet { position:absolute; left:0; right:0; bottom:0; z-index:5; background:#fff; border-top-left-radius:20px; border-top-right-radius:20px; border:1px solid #EEE; border-bottom:0; overflow:hidden; height:200px; transition:height .3s ease; display:flex; flex-direction:column; }
        .map-sheet.open { height:calc(100vh - 110px); }
        .map-sheet .handle-wrapper { position:relative; padding:12px 20px; flex-shrink:0; }
        .map-sheet .handle { width:40px; height:4px; border-radius:2px; background:#DDD; cursor:grab; margin:0 auto; }
        .map-sheet .handle:active { cursor:grabbing; }
        .map-sheet .content { overflow-y:auto; flex:1; min-height:0; }
        .map-sheet:not(.open) .content { overflow:hidden; }
        .map-sheet .list { padding:0 20px 20px 20px; }

        /* Profile screen */
        .profile-header { padding: 10px 20px 0 20px; display: flex; align-items: center; }
        .avatar { width: 56px; height: 56px; border-radius: 28px; overflow: hidden; margin-right: 12px; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .pill { background: #FF7A1A; color: #fff; border-radius: 16px; padding: 6px 10px; margin-left: 8px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 14px 20px 110px 20px; }
        .grid .cell { aspect-ratio: 1; border-radius: 12px; overflow: hidden; }
        .grid .cell img { width: 100%; height: 100%; object-fit: cover; display: block; }
    </style>
</head>
<body>
    <div class="phone-frame">
        <div class="status-bar">
            <span>10:29</span>
            <span>ğŸ“¶ ğŸ”‹</span>
        </div>
        
        <div id="screen-home" class="screen active content-scroll">
          <div class="header">
              <div class="logo">NowTrip</div>
          </div>
          
          <div class="search-bar">
              <span class="search-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18">
                  <circle cx="11" cy="11" r="8"></circle>
                  <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
              </span>
              <span class="search-text">ê²€ìƒ‰</span>
          </div>
          
          <div class="collage-container">
            <div id="home-latest" style="display:block;">
              <div class="section-title">ìµœì‹ ì—…ë¡œë“œ</div>
              <div class="collage-grid" id="home-latest-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;"></div>
            </div>
            
            <div class="section-title">í˜„ì¬ ëœ¨ëŠ” ì—¬í–‰ì§€</div>
            
            <div class="collage-grid">
                <div class="image-wrapper">
                    <img class="link-trending link-top" src="https://images.unsplash.com/photo-1516483638261-f4dbaf036963?w=400&h=400&fit=crop" alt="ì—¬í–‰ì§€ 1">
                </div>
                <div class="image-wrapper">
                    <img class="link-trending link-top" src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400&h=400&fit=crop" alt="ì—¬í–‰ì§€ 2">
                </div>
                <div class="image-wrapper">
                    <img class="link-trending link-top" src="https://images.unsplash.com/photo-1502082553048-f009c37129b9?w=400&h=400&fit=crop" alt="ì—¬í–‰ì§€ 3">
                </div>
                <div class="image-wrapper">
                    <img class="link-trending link-top" src="https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=400&h=400&fit=crop" alt="ì—¬í–‰ì§€ 4">
                </div>
            </div>

            <div class="section-title" style="margin-top:10px;">ì¶”ì²œ ì—¬í–‰ì§€</div>
            <div class="collage-grid">
                <div class="image-wrapper">
                    <img class="link-trending link-reco" src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=400&h=400&fit=crop" alt="ì¶”ì²œ 1">
                </div>
                <div class="image-wrapper">
                    <img class="link-trending link-reco" src="https://images.unsplash.com/photo-1505764706515-aa95265c5abc?w=400&h=400&fit=crop" alt="ì¶”ì²œ 2">
                </div>
                <div class="image-wrapper">
                    <img class="link-trending link-reco" src="https://images.unsplash.com/photo-1493558103817-58b2924bce98?w=400&h=400&fit=crop" alt="ì¶”ì²œ 3">
                </div>
                <div class="image-wrapper">
                    <img class="link-trending link-reco" src="https://images.unsplash.com/photo-1433838552652-f9a46b332c40?w=400&h=400&fit=crop" alt="ì¶”ì²œ 4">
                </div>
            </div>
            <div class="section-title" style="margin-top:10px;">í•´ì‹œíƒœê·¸ ëª¨ìŒ</div>
            <div class="chips" id="home-hashtags"></div>
          </div>
        </div>

        <div id="screen-trending" class="screen">
          <div class="trending-header" style="display:flex; align-items:center; gap:10px; padding:10px 20px 0 20px;">
            <button id="trending-back" class="back-btn" style="border:none; background:#fff; border-radius:10px; padding:6px 10px; cursor:pointer;">â†</button>
            <div>
              <div class="logo-small">NowTrip</div>
              <div id="trending-title" class="section-title" style="margin-top:4px;">í˜„ì¬ ëœ¨ëŠ” ì—¬í–‰ì§€</div>
            </div>
          </div>
          <div id="selected-view" style="padding: 0 10px 10px 10px; display:none;">
            <a id="selected-link" href="#" target="_blank" rel="noopener">
              <div style="width:100%; aspect-ratio: 1.7; overflow:hidden; border-radius:12px;">
                <img id="selected-img" src="" alt="ì„ íƒí•œ ì´ë¯¸ì§€" style="width:100%; height:100%; object-fit:cover; display:block;" />
              </div>
            </a>
            <div style="font-size:12px; color:#666; margin-top:6px;">ì´ë¯¸ì§€ë¥¼ íƒ­í•˜ë©´ ì›ë³¸ ì‚¬ì´íŠ¸ë¡œ ì´ë™í•©ë‹ˆë‹¤.</div>
          </div>
          <div id="mosaic" class="mosaic-grid"></div>
        </div>

        <!-- Search Screen -->
        <div id="screen-search" class="screen">
          <div class="search-header" style="display:flex; align-items:center; gap:10px; padding:10px 20px 0 20px;">
            <button id="search-back" class="back-btn" style="border:none; background:#fff; border-radius:10px; padding:6px 10px; cursor:pointer;">â†</button>
            <div class="logo-small">íƒìƒ‰</div>
          </div>
          <div class="search-input">
            <input id="search-input" placeholder="ê²€ìƒ‰ì–´" />
          </div>
          <div style="padding: 0 20px;">
            <div class="section-title" style="margin-bottom:10px;">ì¶”ì²œ ì§€ì—­</div>
          </div>
          <div class="cards-row" id="recommend-row"></div>
          <div style="padding: 20px 20px 10px 20px;">
            <div class="section-title" style="margin-bottom:10px;">ìµœê·¼ ê²€ìƒ‰ì§€ì—­</div>
          </div>
          <div class="chips" id="recent-chips"></div>
        </div>

        <!-- Region Screen -->
        <div id="screen-region" class="screen">
          <div class="region-header">
            <div id="region-back" class="back-btn">â†</div>
            <div id="region-name" class="logo-small">ì§€ì—­</div>
          </div>
          <div class="badge-row">
            <div class="badge">â˜€ï¸ <span>ë§‘ìŒ, 27Â°C</span></div>
            <div class="badge">ğŸšˆ <span>êµí†µ ì›í™œ</span></div>
          </div>
          <div style="padding: 10px 20px 0 20px;">
          <div id="region-top-title" class="section-title" style="text-align:center;">ì¶”ì²œ í”¼ë“œ</div>
          </div>
          <div id="region-grid" class="region-grid"></div>
        </div>

        <!-- Photo Detail Screen -->
        <div id="screen-photo" class="screen">
          <div style="display:flex; align-items:center; padding:10px 10px 0 10px; gap:10px;">
            <button id="photo-back" style="border:none; background:#fff; border-radius:10px; padding:6px 10px; cursor:pointer;">â† ë’¤ë¡œ</button>
            <div class="section-title" style="margin:0;">ì‚¬ì§„ ìƒì„¸</div>
          </div>
          <div style="width:100%; aspect-ratio: 1; background:#000;">
            <img id="photo-detail-img" src="" style="width:100%; height:100%; object-fit:cover; display:block;"/>
          </div>
          <div style="padding: 16px;">
            <div id="photo-location" class="section-title" style="margin-bottom:6px;">ì•Œ ìˆ˜ ì—†ëŠ” ìœ„ì¹˜</div>
            <div id="photo-tags" style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom:8px;"></div>
            <div id="photo-note" style="color:#333; line-height:20px;">ì‘ì„±ìì˜ ë…¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
          </div>
          <div style="padding: 10px 16px 0 16px;">
            <div class="section-title" style="margin-bottom:10px;">ëŒ“ê¸€</div>
            <div style="display:flex; gap:8px; align-items:center;">
              <input id="photo-cmt-input" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" style="flex:1; height:44px; background:#F5F5F5; border:none; border-radius:12px; padding:0 12px;"/>
              <button id="photo-cmt-add" style="background:#FF7A1A; color:#fff; border:none; border-radius:10px; padding:10px 14px;">ë“±ë¡</button>
            </div>
            <div id="photo-cmt-list" style="margin-top:12px; display:grid; gap:10px;"></div>
          </div>
        </div>

        <!-- Upload Screen -->
        <div id="screen-upload" class="screen">
          <div class="upload-header" style="display:flex; align-items:center; justify-content:space-between; padding:10px 20px 0 20px;">
            <button id="upload-back" class="back-btn" style="border:none; background:#fff; border-radius:10px; padding:6px 10px; cursor:pointer;">â†</button>
            <div class="logo-small">NOW.Trip</div>
            <div style="width:40px;"></div>
          </div>
          <div class="photo-box" id="photo-box">
            <div id="photo-plus" style="text-align:center; color:#999;">
              <div style="font-size:36px;">ï¼‹</div>
              <div>ì‚¬ì§„ ì¶”ê°€</div>
            </div>
            <img id="photo-preview" src="" alt="preview" />
          </div>
          <div class="field">
            <div class="field-title">ìœ„ì¹˜ íƒœê·¸</div>
            <div class="input-box"><input id="up-location" placeholder="ì˜ˆ: ì„œìš¸ ê°•ë‚¨êµ¬" /></div>
          </div>
          <div class="field">
            <div class="field-title">í•´ì‹œíƒœê·¸</div>
            <div id="up-tags-preview" style="display:flex; flex-wrap:wrap; gap:8px; margin-top:6px;"></div>
            <div class="input-box" style="display:flex; gap:8px; align-items:center;">
              <input id="up-hashtags" placeholder="#í•´ì‹œíƒœê·¸ ì…ë ¥ í›„ Enter ë˜ëŠ” ì¶”ê°€ ë²„íŠ¼" />
              <button id="up-hashtags-add" style="background:#FF7A1A;color:#fff;border:none;border-radius:10px;padding:8px 12px;flex:0 0 auto;">ì¶”ê°€</button>
            </div>
          </div>
          <div class="field">
            <div class="field-title">ê°œì¸ ë…¸íŠ¸</div>
            <div class="input-box"><textarea id="up-note" rows="6" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea></div>
          </div>
          <button id="upload-cta" class="upload-cta">ì—…ë¡œë“œ</button>
        </div>

        <!-- Map Screen -->
        <div id="screen-map" class="screen">
          <div class="map-header">
            <div class="logo-small">NOW.Trip</div>
          </div>
          <div class="map-search">
            <input id="map-query" placeholder="ì§€ì—­ ê²€ìƒ‰" />
          </div>
          <div class="map-canvas" id="map-canvas">
            <img class="map-bg" id="map-bg" src="custom-map.jpg.jpeg" />
            <!-- pins rendered by JS -->
          </div>
          <!-- í•€ ìƒì„¸ íŒì—… -->
          <div id="pin-overlay" class="pin-overlay">
            <div class="pin-popup" role="dialog" aria-modal="true">
              <div class="thumb"><img id="pin-img" src="" alt="ì„ íƒ ì´ë¯¸ì§€" /></div>
              <div class="body">
                <div id="pin-title" style="font-size:16px;font-weight:700;"></div>
                <div id="pin-chips" class="chips"></div>
                <div id="pin-note" style="color:#333;line-height:20px;margin-top:8px;"></div>
              </div>
              <div class="cta"><button id="pin-close">ë‹«ê¸°</button></div>
            </div>
          </div>
          <div id="map-sheet" class="map-sheet">
            <div class="handle-wrapper">
              <div class="handle" id="map-sheet-handle"></div>
            </div>
            <div class="content">
              <div class="list" id="map-sheet-list">
                <!-- ì¹´ë“œë“¤ì´ JSë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
              </div>
            </div>
          </div>
          <div id="map-popup-overlay" class="map-popup-overlay">
            <div class="map-popup" role="dialog" aria-modal="true">
              <div class="title">ì§€ì—­ ê²€ìƒ‰</div>
              <div class="input"><input id="map-popup-input" placeholder="ì˜ˆ: ì„œìš¸, ë¶€ì‚°, ì œì£¼..."/></div>
              <div id="map-popup-suggest-title" style="margin-bottom:6px; color:#666;">ì¶”ì²œ ì§€ì—­</div>
              <div id="map-popup-chips" class="chips"></div>
              <div class="footer"><button id="map-popup-close">ë‹«ê¸°</button></div>
            </div>
          </div>
        </div>

        <!-- Profile Screen -->
        <div id="screen-profile" class="screen">
          <div class="profile-header">
            <div class="avatar"><img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=200"/></div>
            <div>
              <div class="logo-small">ì—¬í–‰ì¢‹ì•„í•˜ëŠ”ì‚¬ëŒ</div>
              <div style="color:#666; margin-top:2px;">LV.5</div>
            </div>
          </div>
          <div style="padding: 14px 20px 0 20px;">
            <div class="section-title">íšë“ ë±ƒì§€</div>
          </div>
          <div class="chips" id="profile-badges" style="padding-top: 0;"></div>
          <div style="padding: 14px 20px 0 20px; display:flex; align-items:center;">
            <div style="font-size:24px; font-weight:700;">2000P</div>
            <div class="pill" style="margin-left:10px;">ë‚´ í¬ì¸íŠ¸</div>
            <div class="pill" style="background:#FFA45B; margin-left:8px;">í¬ì¸íŠ¸ ì ë¦½</div>
          </div>
          <div style="padding: 14px 20px 0 20px;">
            <div class="section-title">ë‚´ê°€ ì˜¬ë¦° ì‚¬ì§„</div>
          </div>
          <div class="grid" id="profile-grid"></div>
        </div>
        
        <div class="bottom-nav" id="bottom-nav">
            <div class="nav-button active" data-tab="home">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7"></path><path d="M9 22V12h6v10"></path></svg>
                <div class="nav-text">í™ˆ</div>
            </div>
            <div class="nav-button" data-tab="search">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <div class="nav-text">ê²€ìƒ‰</div>
            </div>
            <div class="upload-button" data-tab="upload">
                <div class="upload-icon">â†‘</div>
            </div>
            <div class="nav-button" data-tab="map">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 6-9 12-9 12S3 16 3 10a9 9 0 1 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                <div class="nav-text">ì§€ë„</div>
            </div>
            <div class="nav-button" data-tab="profile">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                <div class="nav-text">í”„ë¡œí•„</div>
            </div>
        </div>
    </div>
    <script>
      // ì´ë¯¸ì§€ í´ë°± ìœ í‹¸
      function attachFallback(img){
        if(!img || img.__fallbackAttached) return;
        // ì§€ë„ ë°°ê²½ì€ ê³ ì • ì´ë¯¸ì§€ ìœ ì§€ (í´ë°± ì œì™¸)
        if(img.id === 'map-bg' || img.dataset.fixed === 'true') return;
        img.__fallbackAttached = true;
        const onErr = () => {
          img.onerror = null;
          img.src = `https://picsum.photos/seed/nowtrip${Math.floor(Math.random()*10000)}/800/800`;
          img.style.background = '#fff';
        };
        img.onerror = onErr;
        // 5ì´ˆ ë‚´ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê°•ì œ í´ë°±
        let settled = false;
        img.addEventListener('load', () => { settled = true; }, { once: true });
        setTimeout(() => {
          if(!settled || !img.complete || img.naturalWidth === 0){
            try { onErr(); } catch(e) {}
          }
        }, 5000);
      }
      function hookAllImages(){ document.querySelectorAll('img').forEach(attachFallback); }
      // ìµœì‹ ì—…ë¡œë“œ(ì´ˆê¸° 4ì¥ ì„¸íŒ…)
      window.__latest = window.__latest || [
        { src: 'https://images.unsplash.com/photo-1495298599282-d8920eb5009f?q=80&w=800&auto=format&fit=crop' },
        { src: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=800&auto=format&fit=crop' },
        { src: 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=800&auto=format&fit=crop' },
        { src: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=800&auto=format&fit=crop' },
      ];
      function renderLatest(){
        const grid = document.getElementById('home-latest-grid');
        if(!grid) return;
        grid.innerHTML='';
        const items = window.__latest;
        for(let i=0;i<4;i++){
          const it = items[i];
          const cell = document.createElement('div'); cell.className='image-wrapper';
          if(it){
            cell.style.position='relative';
            const im=document.createElement('img'); im.src=it.src; attachFallback(im); cell.appendChild(im);
            const minutes = Math.max(0, Math.floor((Date.now() - (it.ts||Date.now()))/60000));
            const label = minutes<=0 ? 'ë°©ê¸ˆ' : `${minutes}ë¶„ ì „`;
            const badge = document.createElement('div'); badge.className='time-badge'; badge.textContent=label; cell.appendChild(badge);
            cell.addEventListener('click', () => { const t=document.getElementById('trending-title'); if(t) t.textContent='ìµœì‹ ì—…ë¡œë“œ'; showScreen('trending'); if (mosaic.childElementCount === 0) addItems(24); });
          }
          grid.appendChild(cell);
        }
      }
      renderLatest();
      const __mo = new MutationObserver(hookAllImages); __mo.observe(document.documentElement, {childList:true, subtree:true});
      hookAllImages();

      const screens = {
        home: document.getElementById('screen-home'),
        trending: document.getElementById('screen-trending'),
        search: document.getElementById('screen-search'),
        region: document.getElementById('screen-region'),
        upload: document.getElementById('screen-upload'),
        map: document.getElementById('screen-map'),
        profile: document.getElementById('screen-profile'),
        photo: document.getElementById('screen-photo'),
      };

      // ì§€ë„ ë°°ê²½: ì˜ˆì‹œì™€ ìœ ì‚¬í•œ í•œêµ­ ì§€ë„ ì‚¬ìš©, ì‹¤íŒ¨ ì‹œ ìœ„ì¹˜ì§€ë„ í´ë°±
      const mapBg = document.getElementById('map-bg');
      if(mapBg){
        // ê³ ì • ì´ë¯¸ì§€ í‘œì‹œ í”Œë˜ê·¸
        mapBg.setAttribute('data-fixed', 'true');

        // í›„ë³´ URLë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹œë„ (ì„±ê³µ ì‹œ ì¤‘ë‹¨)
        const candidateUrls = [
          // 1) í˜„ì¬ í´ë”(ë£¨íŠ¸) íŒŒì¼
          'custom-map.jpg.jpeg',
          'custom-map.jpg',
          // 2) assets í´ë”ì— ìˆì„ ìˆ˜ ìˆëŠ” ê²½ìš°
          'assets/custom-map.jpg.jpeg',
          'assets/custom-map.jpg',
          // 3) ì™¸ë¶€ ì˜¨ë¼ì¸ ì§€ë„
          'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/Provinces_of_South_Korea_map.png/800px-Provinces_of_South_Korea_map.png',
          'https://upload.wikimedia.org/wikipedia/commons/thumb/1/19/South_Korea_location_map.svg/1024px-South_Korea_location_map.svg.png'
        ];

        let idx = 0;
        const tryNext = () => {
          if(idx >= candidateUrls.length) return;
          const next = candidateUrls[idx++];
          mapBg.onerror = tryNext;
          mapBg.src = next;
        };

        // ë¡œë“œ ì§€ì—° ì‹œ ë‹¤ìŒ í›„ë³´ë¡œ ì´ë™
        const timeoutMs = 2500;
        const armTimeout = () => {
          setTimeout(() => {
            if(!mapBg.complete || mapBg.naturalWidth === 0){ tryNext(); }
          }, timeoutMs);
        };
        mapBg.addEventListener('load', () => {/* ì„±ê³µ */}, { once: true });

        // ìµœì´ˆ íŠ¸ë¦¬ê±°
        tryNext();
        armTimeout();
      }

      function showScreen(name){
        Object.values(screens).forEach(el => el.classList.remove('active'));
        screens[name].classList.add('active');
        // í™”ë©´ ì „í™˜ ì‹œ ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ë¡œ
        screens[name].scrollTop = 0;
        // íŠ¸ë Œë”© ìµœì´ˆ ì§„ì… ì‹œ í™”ë©´ì„ ì¶©ë¶„íˆ ì±„ìš°ë„ë¡ ë¡œë“œ
        if(name === 'trending' && mosaic.childElementCount === 0){
          addItems(24);
        }
      }

      // í™ˆ ì¸ë„¤ì¼: ì‹œê°„ ë°°ì§€ ì¶”ê°€ + íŠ¸ë Œë”© í™”ë©´ ì´ë™
      document.querySelectorAll('.link-trending').forEach((img, idx) => {
        attachFallback(img);
        // ì‹œê°„ ë°°ì§€
        const wrap = img.closest('.image-wrapper');
        if(wrap && !wrap.querySelector('.time-badge')){
          const badge = document.createElement('div');
          badge.className = 'time-badge';
          const minutesAgo = (idx % 59) + 1;
          badge.textContent = `${minutesAgo}ë¶„ ì „`;
          wrap.appendChild(badge);
        }
        img.addEventListener('click', () => {
          const titleEl = document.getElementById('trending-title');
          if(img.classList.contains('link-reco')) {
            titleEl.textContent = 'ì¶”ì²œ ì—¬í–‰ì§€';
          } else {
            titleEl.textContent = 'í˜„ì¬ ëœ¨ëŠ” ì—¬í–‰ì§€';
          }
          showScreen('trending');
          if (mosaic.childElementCount === 0) addItems(24);
        });
      });

      // í™ˆ ê²€ìƒ‰ ë°” í´ë¦­ ì‹œ ê²€ìƒ‰ í™”ë©´ìœ¼ë¡œ ì´ë™
      const homeSearch = document.querySelector('#screen-home .search-bar');
      if (homeSearch) {
        homeSearch.addEventListener('click', () => {
          activateTab('search');
          showScreen('search');
          document.getElementById('search-input').focus();
        });
      }

      // í™ˆ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
      const homeUpdated = document.getElementById('home-updated');
      function setHomeUpdated(){
        const t = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
        if(homeUpdated) homeUpdated.textContent = `ì—…ë°ì´íŠ¸ ${t}`;
      }
      setHomeUpdated();

      // í™ˆ í•´ì‹œíƒœê·¸ ëª¨ìŒ ë Œë”ë§ ë° í´ë¦­ ì´ë™
      const homeHashWrap = document.getElementById('home-hashtags');
      if(homeHashWrap){
        const tags = ['ê°€ì„í’ê²½','ë‹¨í’','ë‚™ì—½','í˜¸ìˆ˜','ë°”ë‹¤','ì‚°ì±…','ì•¼ê²½','ì¶•ì œ','ë§›ì§‘','ë“œë¼ì´ë¸Œ'];
        homeHashWrap.innerHTML = '';
        tags.forEach(tag => {
          const chip = document.createElement('div');
          chip.className = 'chip';
          chip.textContent = `#${tag}`;
          chip.addEventListener('click', () => openRegion(`#${tag}`));
          homeHashWrap.appendChild(chip);
        });
      }

      // í•˜ë‹¨ë°” í™œì„±í™” í† ê¸€
      const nav = document.getElementById('bottom-nav');
      function activateTab(tab){
        nav.querySelectorAll('.nav-button, .upload-button').forEach(b => b.classList.remove('active'));
        const btn = nav.querySelector(`[data-tab="${tab}"]`);
        if(btn) btn.classList.add('active');
      }
      nav.querySelectorAll('.nav-button, .upload-button').forEach(btn => {
        btn.addEventListener('click', () => {
          activateTab(btn.dataset.tab);
          if(btn.dataset.tab === 'home') showScreen('home');
          if(btn.dataset.tab === 'search') showScreen('search');
          if(btn.dataset.tab === 'upload') showScreen('upload');
          if(btn.dataset.tab === 'map') showScreen('map');
          if(btn.dataset.tab === 'profile') showScreen('profile');
        });
      });

      // ê³µí†µ ë’¤ë¡œê°€ê¸°: í™ˆìœ¼ë¡œ ì´ë™
      const goHome = () => { activateTab('home'); showScreen('home'); };
      const tb = document.getElementById('trending-back'); if(tb) tb.addEventListener('click', goHome);
      const sb = document.getElementById('search-back'); if(sb) sb.addEventListener('click', goHome);
      const ub = document.getElementById('upload-back'); if(ub) ub.addEventListener('click', goHome);

      // íŠ¸ë Œë”© í™”ë©´ ë¬´í•œ ìŠ¤í¬ë¡¤ (ì‚¬ìš©ì ì§€ì • ì´ë¯¸ì§€ ëª©ë¡ ìˆœí™˜)
      const mosaic = document.getElementById('mosaic');
      const userImages = [
        'https://images.unsplash.com/photo-1495298599282-d8920eb5009f?q=80&w=1600&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1600&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=1600&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1502082553048-f009c37129b9?q=80&w=1600&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1470770841072-f978cf4d019e?q=80&w=1600&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?q=80&w=1600&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1500534311325-3df9c2c7f06e?q=80&w=1600&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1500534311218-1c8dbbfb0d5e?q=80&w=1600&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=1600&auto=format&fit=crop'
      ];
      let imgIndex = 0;
      const nextImg = () => {
        const url = userImages[imgIndex % userImages.length];
        imgIndex += 1;
        return url;
      };

      function addItems(count=12){
        for(let i=0;i<count;i++){
          const div = document.createElement('div');
          div.className = 'mosaic-item';
          div.style.position = 'relative';
          const url = nextImg();
          const img = document.createElement('img');
          img.src = url; attachFallback(img);
          div.appendChild(img);
          const badge = document.createElement('div');
          const minutesAgo = ((mosaic.childElementCount + i) % 59) + 1;
          badge.className = 'time-badge';
          badge.textContent = `${minutesAgo}ë¶„ ì „`;
          div.appendChild(badge);
          div.addEventListener('click', () => {
            const title = document.getElementById('trending-title').textContent || 'ì—¬í–‰ì§€';
            openPhotoDetail({ url, location: title, tags: ['#ì—¬í–‰'], note: 'í˜„ì¥ì˜ ë¶„ìœ„ê¸°ë¥¼ ë‹´ì•˜ì–´ìš”.' });
          });
          mosaic.appendChild(div);
        }
      }
      // ì´ˆê¸°ì—ëŠ” í•„ìš”ì‹œ ì±„ì›€ (í™ˆì—ì„œ íŠ¸ë Œë”©ìœ¼ë¡œ ì§„ì… ë•Œë„ ë³´ì™„)
      // addItemsëŠ” showScreenì—ì„œ í˜¸ì¶œë¨

      // ê²€ìƒ‰ í™”ë©´ ë°ì´í„° (ì¶”ì²œ/ìµœê·¼)
      const recommendRow = document.getElementById('recommend-row');
      const recommended = [
        { title: 'ì„œìš¸', uri: 'https://images.unsplash.com/photo-1549692520-acc6669e2f0c?w=400&h=400&fit=crop' },
        { title: 'ë¶€ì‚°', uri: 'https://images.unsplash.com/photo-1606660585005-8c2f2740d37a?w=400&h=400&fit=crop' },
        { title: 'ì œì£¼', uri: 'https://images.unsplash.com/photo-1519060825752-c7aaf69de7a7?w=400&h=400&fit=crop' },
        { title: 'ê²½ì£¼', uri: 'https://images.unsplash.com/photo-1582107922510-81c3e41e80be?w=400&h=400&fit=crop' },
      ];
      recommended.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<div class="thumb"><img src="${item.uri}"/></div><div class="label">${item.title}</div>`;
        recommendRow.appendChild(card);
      });
      setTimeout(() => recommendRow.querySelectorAll('img').forEach(attachFallback));

      const recentChips = document.getElementById('recent-chips');
      let recent = ['ê°•ë¦‰','ì „ì£¼ í•œì˜¥ë§ˆì„','ì „ì£¼','ê²½ì£¼ ë¶ˆêµ­ì‚¬'];
      function renderRecent(){
        recentChips.innerHTML = '';
        recent.forEach(r => {
          const chip = document.createElement('div');
          chip.className = 'chip';
          chip.textContent = r;
          chip.addEventListener('click', () => openRegion(r));
          recentChips.appendChild(chip);
        });
      }
      renderRecent();

      const searchInput = document.getElementById('search-input');
      searchInput.addEventListener('keydown', (e) => {
        if(e.key === 'Enter'){
          const q = searchInput.value.trim();
          if(!q) return;
          recent = [q, ...recent.filter(v => v !== q)].slice(0, 8);
          searchInput.value = '';
          renderRecent();
          openRegion(q);
        }
      });

      // ì¶”ì²œ ì¹´ë“œ í´ë¦­ ì‹œ ì§€ì—­ í™”ë©´ ì´ë™
      recommendRow.addEventListener('click', (e) => {
        const card = e.target.closest('.card');
        if(!card) return;
        const name = card.querySelector('.label')?.textContent || 'ì§€ì—­';
        openRegion(name);
      });

      // ì§€ì—­ í™”ë©´ ë¡œì§
      const regionGrid = document.getElementById('region-grid');
      const regionNameEl = document.getElementById('region-name');
      document.getElementById('region-back').addEventListener('click', () => {
        showScreen('search');
        activateTab('search');
      });

      let regionSeed = 1;
      let regionCount = 0; // ëˆ„ì  ì¶”ê°€ëœ ì´ë¯¸ì§€ ìˆ˜
      let bloomInserted = false; // ê°œí™”ì •ë³´ ì œëª© ì‚½ì… ì—¬ë¶€
      let recoInserted = false; // ê°€ë³¼ë§Œí•œ ê³³ ì„¹ì…˜ ì‚½ì… ì—¬ë¶€
      function addRegionItems(count=10){
        for(let i=0;i<count;i++){
          // 6ì¥ ì±„ìš°ê³  ê°œí™”ì •ë³´ ì œëª©ì„ í•œ ë²ˆë§Œ ì‚½ì…
          if(!bloomInserted && regionCount >= 6){
            const mid = document.createElement('div');
            mid.style.cssText = 'grid-column: 1 / -1; text-align:center; padding:4px 0;';
            const name = regionNameEl.textContent || 'ì§€ì—­';
            mid.innerHTML = `<div class="section-title" style="font-weight:700; text-align:center;">${name} ê°œí™”ìƒí™©</div>`;
            regionGrid.appendChild(mid);
            bloomInserted = true;
          }
          // ê°œí™”ì •ë³´ ë’¤ë¡œ 6ì¥ ì§€ë‚œ ë’¤ ê°€ë³¼ë§Œí•œ ê³³ ì„¹ì…˜ ì‚½ì…(1íšŒ)
          if(bloomInserted && !recoInserted && regionCount >= 12){
            const sec = document.createElement('div');
            sec.style.cssText = 'grid-column: 1 / -1; padding:4px 0;';
            const nm = regionNameEl.textContent || 'ì§€ì—­';
            sec.innerHTML = `<div class="section-title" style="font-weight:700; text-align:center;">${nm} ê°€ë³¼ë§Œí•œ ê³³</div>`;
            regionGrid.appendChild(sec);
            // 6ê°œ ì¶”ì²œ ì‚¬ì§„(2ì—´ x 3í–‰)
            const wrap = document.createElement('div');
            wrap.style.cssText = 'grid-column: 1 / -1; display:grid; grid-template-columns: 1fr 1fr; gap:12px; padding: 0 0 0 0;';
            for(let k=0;k<6;k++){
              const cell = document.createElement('div');
              cell.className = 'region-item';
              cell.style.position = 'relative';
              const img = document.createElement('img');
              img.src = `https://source.unsplash.com/random/600x600?sig=${regionSeed++}&spot,travel`;
              attachFallback(img);
              cell.appendChild(img);
              wrap.appendChild(cell);
            }
            regionGrid.appendChild(wrap);
            recoInserted = true;
          }
          const div = document.createElement('div');
          div.className = 'region-item';
          div.style.position = 'relative';
          const img = document.createElement('img');
          if(bloomInserted){
            img.src = `https://source.unsplash.com/random/600x600?sig=${regionSeed++}&flower,blossom,spring`;
          } else {
            img.src = `https://source.unsplash.com/random/600x600?sig=${regionSeed++}&travel,landscape`;
          }
          attachFallback(img);
          div.appendChild(img);
          const badge = document.createElement('div');
          const minutesAgo = ((regionCount + i) % 59) + 1;
          badge.className = 'time-badge';
          badge.textContent = `${minutesAgo}ë¶„ ì „`;
          div.appendChild(badge);
          regionGrid.appendChild(div);
          regionCount += 1;
        }
      }
      let lastScreen = 'home';
      function openRegion(name){
        regionNameEl.textContent = name;
        regionGrid.innerHTML = '';
        regionSeed = 1;
        regionCount = 0;
        bloomInserted = false;
        addRegionItems(20);
        showScreen('region');
      }

      // ì§€ì—­ í™”ë©´ ë¬´í•œ ìŠ¤í¬ë¡¤
      document.addEventListener('scroll', () => {
        if(!screens.region.classList.contains('active')) return;
        const nearBottom = window.innerHeight + window.scrollY >= document.body.scrollHeight - 180;
        if(nearBottom){ addRegionItems(12); }
      });

      // ì§€ì—­ ê·¸ë¦¬ë“œì—ì„œ ì´ë¯¸ì§€ í´ë¦­ ì‹œ ì‚¬ì§„ ìƒì„¸ë¡œ ì´ë™
      regionGrid.addEventListener('click', (e) => {
        const img = e.target.closest('img');
        if(!img) return;
        openPhotoDetail({ url: img.getAttribute('src'), location: regionNameEl.textContent || 'ì§€ì—­', tags: ['#ëª…ì†Œ'], note: 'í˜„ì¥ ì‚¬ì§„ì…ë‹ˆë‹¤.' });
      });

      // ìƒì„¸ í™”ë©´ ë¡œì§
      function openPhotoDetail({ url, location, tags, note }){
        const big = document.getElementById('photo-detail-img');
        const safe = url && typeof url === 'string' ? url : `https://picsum.photos/seed/photodetail_web/1200/1200`;
        // ê°•ì œ í´ë°± + íƒ€ì„ì•„ì›ƒ í´ë°±
        const fallbackUrl = `https://picsum.photos/seed/photodetail_web_fallback_${Date.now()}/1200/1200`;
        let settled = false;
        big.onerror = () => {
          if (settled) return;
          settled = true;
          big.onerror = null;
          big.src = fallbackUrl;
        };
        big.onload = () => { settled = true; };
        big.removeAttribute('src');
        big.src = safe;
        setTimeout(() => { if(!settled || !big.complete || big.naturalWidth === 0){ big.src = fallbackUrl; } }, 4000);
        attachFallback(big);
        document.getElementById('photo-location').textContent = location || 'ì•Œ ìˆ˜ ì—†ëŠ” ìœ„ì¹˜';
        const t = document.getElementById('photo-tags');
        t.innerHTML = '';
        (tags||[]).forEach(tag => {
          const chip = document.createElement('div');
          chip.className = 'chip';
          chip.textContent = tag;
          t.appendChild(chip);
        });
        document.getElementById('photo-note').textContent = note || '';
        renderComments();
        lastScreen = Object.keys(screens).find(k => screens[k].classList.contains('active')) || 'home';
        showScreen('photo');
      }

      // ë³„ë„ ì˜¤ë²„ë ˆì´ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (ë°”í…€ì‹œíŠ¸ì— í†µí•©)
      const cmtInput = document.getElementById('photo-cmt-input');
      const cmtList = document.getElementById('photo-cmt-list');
      const nowKR = () => new Date().toLocaleString('ko-KR', { month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit' });
      const nicks = ['ë°”ë‹¤ì—¬í–‰ëŸ¬','í•œê°•ì‚°ì±…ëŸ¬','ë‹¬ë¹›ì‚¬ì§„ê°€','ì˜¤ë¡œë¼í—Œí„°','ìº í•‘ì¢‹ì•„','ìˆœìˆ˜í•œì—¬í–‰ê°€','í’ê²½ìˆ˜ì§‘ê°€'];
      const pickNick = () => nicks[Math.floor(Math.random()*nicks.length)];
      let commentsData = [
        { id: 'c1', author:'ë°”ë‹¤ëŸ¬ë²„', time: nowKR(), text: 'ë©‹ì ¸ìš”!', replies: [{ id: 'r1', author:'ì—¬í–‰ì´ ë„ˆë¬´ ì¡°í•˜ìš”', time: nowKR(), text: 'ë™ê°ì…ë‹ˆë‹¤!' }] },
        { id: 'c2', author:'ì—¬í–‰ì´ ë„ˆë¬´ ì¡°í•˜ìš”', time: nowKR(), text: 'ì¢‹ì€ ì •ë³´ ê°ì‚¬í•´ìš”', replies: [] }
      ];
      function renderComments(){
        cmtList.innerHTML = '';
        commentsData.forEach(c => {
          const wrap = document.createElement('div');
          wrap.style.cssText = 'background:#fff;border:1px solid #EEE;border-radius:10px;padding:10px;';
          const head = document.createElement('div');
          head.style.cssText='display:flex;align-items:center;gap:8px;margin-bottom:6px;color:#666;font-size:12px;';
          const name = document.createElement('strong'); name.textContent = c.author || 'ì‘ì„±ì'; name.style.color='#000'; name.style.fontSize='13px';
          const time = document.createElement('span'); time.textContent = c.time || nowKR();
          head.appendChild(name); head.appendChild(time); wrap.appendChild(head);
          const text = document.createElement('div');
          text.textContent = c.text;
          text.style.cssText='margin-bottom:6px;line-height:20px;';
          wrap.appendChild(text);
          // replies
          if(c.replies.length){
            c.replies.forEach(r => {
              const rdiv = document.createElement('div');
              rdiv.style.cssText = 'margin-left:12px;background:#FAFAFA;border:1px solid #F0F0F0;border-radius:8px;padding:8px;margin-top:6px;';
              const rhead = document.createElement('div');
              rhead.style.cssText='display:flex;align-items:center;gap:8px;margin-bottom:4px;color:#666;font-size:12px;';
              const rname = document.createElement('strong'); rname.textContent = r.author || 'ì‘ì„±ì'; rname.style.color='#000'; rname.style.fontSize='13px';
              const rtime = document.createElement('span'); rtime.textContent = r.time || nowKR();
              rhead.appendChild(rname); rhead.appendChild(rtime); rdiv.appendChild(rhead);
              const rtext = document.createElement('div'); rtext.textContent = r.text; rtext.style.lineHeight='20px';
              rdiv.appendChild(rtext);
              wrap.appendChild(rdiv);
            });
          }
          // reply box
          const box = document.createElement('div');
          box.style.cssText = 'display:flex;gap:6px;align-items:center;margin-top:8px;';
          const inp = document.createElement('input');
          inp.placeholder = 'ë‹µê¸€ ì…ë ¥';
          inp.style.cssText = 'flex:1;height:36px;background:#F8F8F8;border:none;border-radius:10px;padding:0 10px;';
          const btn = document.createElement('button');
          btn.textContent = 'ë“±ë¡';
          btn.style.cssText = 'background:#FF7A1A;color:#fff;border:none;border-radius:8px;padding:8px 12px;';
          btn.addEventListener('click', () => {
            const t = inp.value.trim(); if(!t) return;
            c.replies.unshift({ id: 'r'+Date.now(), author: pickNick(), time: nowKR(), text: t });
            renderComments();
          });
          box.appendChild(inp); box.appendChild(btn); wrap.appendChild(box);
          cmtList.appendChild(wrap);
        });
      }
      document.getElementById('photo-cmt-add').addEventListener('click', () => {
        const v = cmtInput.value.trim();
        if(!v) return; commentsData.unshift({ id:'c'+Date.now(), author: pickNick(), time: nowKR(), text:v, replies:[] }); cmtInput.value=''; renderComments();
      });
      document.getElementById('photo-back').addEventListener('click', () => showScreen(lastScreen));
      // ì—…ë¡œë“œ ë²„íŠ¼: ëˆ„ì  2x2(ìµœëŒ€ 4) ìœ ì§€, ì´í›„ëŠ” ìš°í•˜ë‹¨ë¶€í„° êµì²´
      const uploadBtn = document.getElementById('upload-cta');
      if(uploadBtn){
        uploadBtn.addEventListener('click', () => {
          // ì—…ë¡œë“œëœ í”„ë¦¬ë·°ë¥¼ ì´ìš©í•´ í™ˆ ìƒë‹¨ì— ì¶”ê°€í•˜ê³  í™ˆìœ¼ë¡œ ì´ë™
          const img = document.getElementById('photo-preview');
          const src = img && img.getAttribute('src') ? img.getAttribute('src') : `https://source.unsplash.com/random/1200x800?travel`;
          const loc = (document.getElementById('up-location').value || '').trim();
          const tagsRaw = (document.getElementById('up-hashtags').value || '').trim();
          const note = (document.getElementById('up-note').value || '').trim();
          const extra = tagsRaw ? tagsRaw.split(',').map(t => normalizeTag(t)).filter(Boolean) : [];
          const tags = Array.from(new Set([...(window.__upTags || []), ...extra]));

          // ìµœì‹ ì—…ë¡œë“œ ê°±ì‹ (ì¢Œìƒë‹¨ ë‚´ ì—…ë¡œë“œ)
          window.__latest = [{ src }, ...window.__latest].slice(0,4);
          renderLatest();

          // ìµœìµœì‹ ì—…ë¡œë“œ ì„¹ì…˜ ì œê±°: ìµœì‹ ì—…ë¡œë“œë§Œ ìœ ì§€
          // í™ˆìœ¼ë¡œ ì´ë™ ë° íƒ­ í™œì„±í™”
          activateTab('home'); showScreen('home');
          // ìŠ¤í¬ë¡¤ ìµœìƒë‹¨
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }

      // ì—…ë¡œë“œ í™”ë©´: í•´ì‹œíƒœê·¸ ì¹©(Enter/í„°ì¹˜ ì¶”ê°€ + í„°ì¹˜ ì œê±°)
      const upTagsInput = document.getElementById('up-hashtags');
      const upTagsAdd = document.getElementById('up-hashtags-add');
      const upTagsPreview = document.getElementById('up-tags-preview');
      window.__upTags = window.__upTags || [];
      function normalizeTag(raw){
        const t = (raw||'').trim().replace(/\s+/g, '');
        if(!t) return '';
        return t.startsWith('#') ? t : `#${t}`;
      }
      function renderUpTags(){
        upTagsPreview.innerHTML = '';
        window.__upTags.forEach(tag => {
          const chip = document.createElement('div');
          chip.style.cssText = 'background:#F1F1F1;padding:6px 10px;border-radius:12px;color:#333;font-size:14px;cursor:pointer;';
          chip.textContent = tag;
          chip.title = 'íƒ­í•˜ì—¬ ì œê±°';
          chip.addEventListener('click', () => {
            window.__upTags = window.__upTags.filter(t => t !== tag);
            renderUpTags();
          });
          upTagsPreview.appendChild(chip);
        });
      }
      function addUpTag(){
        const tag = normalizeTag(upTagsInput.value);
        if(!tag) return;
        if(!window.__upTags.includes(tag)) window.__upTags.unshift(tag);
        upTagsInput.value = '';
        renderUpTags();
      }
      if(upTagsInput){
        upTagsInput.addEventListener('keydown', (e) => { if(e.key==='Enter'){ e.preventDefault(); addUpTag(); }});
      }
      if(upTagsAdd){ upTagsAdd.addEventListener('click', addUpTag); }

      // ì—…ë¡œë“œ í™”ë©´: í”ŒëŸ¬ìŠ¤/ì‚¬ì§„ ë°•ìŠ¤ í´ë¦­ ì‹œ í”½ì»¤ í‘œì‹œ
      function openPicker(){
        const overlay = document.createElement('div');
        overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.4)';
        overlay.addEventListener('click', () => document.body.removeChild(overlay));
        const sheet = document.createElement('div');
        sheet.className = 'picker-sheet';
        sheet.innerHTML = `
          <div class="card">
            <div class="btn" id="pick-camera">ì¹´ë©”ë¼ë¡œ ì´¬ì˜</div>
            <div class="sep"></div>
            <div class="btn" id="pick-gallery">ê°¤ëŸ¬ë¦¬ì—ì„œ ì„ íƒ</div>
          </div>
          <div class="card" style="margin-top:8px;">
            <div class="btn" id="pick-cancel" style="color:#FF3B30;">ì·¨ì†Œ</div>
          </div>`;
        overlay.appendChild(sheet);
        document.body.appendChild(overlay);
        function setPreview(url){
          const img = document.getElementById('photo-preview');
          const plus = document.getElementById('photo-plus');
          img.setAttribute('src', url);
          img.style.display = 'block';
          plus.style.display = 'none';
        }
        sheet.querySelector('#pick-camera').addEventListener('click', () => { setPreview('https://images.unsplash.com/photo-1516483638261-f4dbaf036963?w=1200'); document.body.removeChild(overlay); });
        sheet.querySelector('#pick-gallery').addEventListener('click', () => { setPreview('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1200'); document.body.removeChild(overlay); });
        sheet.querySelector('#pick-cancel').addEventListener('click', () => document.body.removeChild(overlay));
      }
      const photoPlus = document.getElementById('photo-plus');
      const photoBox = document.getElementById('photo-box');
      const photoPreview = document.getElementById('photo-preview');
      if(photoPlus) photoPlus.addEventListener('click', openPicker);
      if(photoBox) photoBox.addEventListener('click', openPicker);
      if(photoPreview) photoPreview.addEventListener('click', openPicker);

      // ê°„ë‹¨í•œ ì´ë¯¸ì§€ ê¸°ë°˜ ì§€ë„: í•€ì„ ìƒëŒ€ ì¢Œí‘œë¡œ ë°°ì¹˜
      const mapCanvas = document.getElementById('map-canvas');
      let pins = [
        { x: 46, y: 36, title: 'ì„œìš¸', url: 'https://images.unsplash.com/photo-1549692520-acc6669e2f0c?w=300' },
        { x: 50, y: 42, title: 'ì¸ì²œ', url: 'https://images.unsplash.com/photo-1516483638261-f4dbaf036963?w=300' },
        { x: 44, y: 43, title: 'ìˆ˜ì›', url: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=300' },
        { x: 38, y: 49, title: 'ëŒ€ì „', url: 'https://images.unsplash.com/photo-1502082553048-f009c37129b9?w=300' },
        { x: 33, y: 60, title: 'ê´‘ì£¼', url: 'https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=300' },
        { x: 53, y: 62, title: 'ë¶€ì‚°', url: 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=300' },
        { x: 49, y: 58, title: 'ëŒ€êµ¬', url: 'https://images.unsplash.com/photo-1505764706515-aa95265c5abc?w=300' },
        { x: 56, y: 56, title: 'ìš¸ì‚°', url: 'https://images.unsplash.com/photo-1493558103817-58b2924bce98?w=300' },
        { x: 60, y: 70, title: 'í¬í•­', url: 'https://images.unsplash.com/photo-1433838552652-f9a46b332c40?w=300' },
        { x: 30, y: 40, title: 'ì „ì£¼', url: 'https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?w=300' },
        { x: 36, y: 34, title: 'êµ°ì‚°', url: 'https://images.unsplash.com/photo-1500534311325-3df9c2c7f06e?w=300' },
        { x: 25, y: 30, title: 'ëª©í¬', url: 'https://images.unsplash.com/photo-1500534311218-1c8dbbfb0d5e?w=300' },
        { x: 48, y: 80, title: 'ì œì£¼', url: 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=300' },
        { x: 53, y: 28, title: 'ì¶˜ì²œ', url: 'https://images.unsplash.com/photo-1470770841072-f978cf4d019e?w=300' },
        { x: 58, y: 33, title: 'ê°•ë¦‰', url: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=300' },
      ];
      const originalPins = [...pins];
      function renderPins(highlight){
        mapCanvas.querySelectorAll('.pin').forEach(n=>n.remove());
        pins.forEach(p => {
          const pin = document.createElement('div');
          pin.className = 'pin' + (highlight===p.title ? ' active' : '');
          pin.style.left = p.x + '%';
          pin.style.top = p.y + '%';
          const im = document.createElement('img'); im.src = p.url; attachFallback(im); pin.appendChild(im);
          pin.addEventListener('click', () => {
            window.__pinDetail = p;
            // ì¤‘ê°„ ìƒíƒœë¡œ ë¨¼ì € ë„ìš°ê³ , ì‚¬ìš©ìê°€ ì˜¬ë¦¬ë©´ ìƒì„¸ê°€ ë³´ì„
            mapSheet.style.height = MIN_H + 'px';
            renderHotelCards();
          });
          mapCanvas.appendChild(pin);
        });
      }
      renderPins();

      // ì§€ë„ ë¹ˆ ì˜ì—­ í´ë¦­ ì‹œ: ê¸°ì¡´ íŒì—…(ì½œë¼ì£¼) í˜•íƒœ ì¤‘ê°„ ë†’ì´ë¡œ ì—´ê¸°
      if(mapCanvas){
        mapCanvas.addEventListener('click', (e) => {
          if(e.target.closest('.pin')) return; // í•€ í´ë¦­ì€ ì œì™¸
          window.__pinDetail = null;
          mapSheet.style.height = MIN_H + 'px';
          renderHotelCards();
        });
      }

      // ì§€ë„ ì¸ì•± ê²€ìƒ‰ íŒì—… ë¡œì§
      const mapPopup = document.getElementById('map-popup-overlay');
      const mapPopupInput = document.getElementById('map-popup-input');
      const mapPopupClose = document.getElementById('map-popup-close');
      const mapPopupChips = document.getElementById('map-popup-chips');
      const mapPopupSuggestTitle = document.getElementById('map-popup-suggest-title');
      const regionAttractions = {
        'ì„œìš¸': ['ê²½ë³µê¶', 'ë‚¨ì‚°íƒ€ì›Œ', 'ë¶ì´Œí•œì˜¥ë§ˆì„', 'í•œê°•ê³µì›'],
        'ë¶€ì‚°': ['í•´ìš´ëŒ€', 'ê°ì²œë¬¸í™”ë§ˆì„', 'ê´‘ì•ˆë¦¬', 'íƒœì¢…ëŒ€'],
        'ì œì£¼': ['ì„±ì‚°ì¼ì¶œë´‰', 'í˜‘ì¬í•´ìˆ˜ìš•ì¥', 'ìš°ë„', 'í•œë¼ì‚°'],
        'ê²½ì£¼': ['ë¶ˆêµ­ì‚¬', 'ëŒ€ë¦‰ì›', 'ì²¨ì„±ëŒ€', 'ë³´ë¬¸ì •']
      };
      const regionKeys = Object.keys(regionAttractions);
      function renderPopupChips(key){
        mapPopupChips.innerHTML = '';
        if(key){
          mapPopupSuggestTitle.textContent = `${key} ëŒ€í‘œ ê´€ê´‘ì§€`;
          regionAttractions[key].forEach(name => {
            const chip = document.createElement('div'); chip.className='chip'; chip.textContent = `#${name}`;
            chip.addEventListener('click', () => { mapPopup.style.display='none'; focusRegion(key); });
            mapPopupChips.appendChild(chip);
          });
        } else {
          mapPopupSuggestTitle.textContent = 'ì¶”ì²œ ì§€ì—­';
          regionKeys.forEach(rk => {
            const chip = document.createElement('div'); chip.className='chip'; chip.textContent = rk;
            chip.addEventListener('click', () => { mapPopup.style.display='none'; focusRegion(rk); });
            mapPopupChips.appendChild(chip);
          });
        }
      }
      // ê²€ìƒ‰ì°½ í¬ì»¤ìŠ¤ ì‹œ íŒì—… ì—´ê¸°
      const mapQuery = document.getElementById('map-query');
      if(mapQuery){
        mapQuery.addEventListener('focus', () => {
          mapPopup.style.display = 'block';
          mapPopupInput.value = '';
          renderPopupChips(null);
          setTimeout(() => mapPopupInput.focus(), 0);
        });
      }
      if(mapPopupClose){ mapPopupClose.addEventListener('click', () => { mapPopup.style.display='none'; }); }
      if(mapPopup){ mapPopup.addEventListener('click', (e) => { if(e.target === mapPopup) mapPopup.style.display='none'; }); }
      if(mapPopupInput){
        mapPopupInput.addEventListener('input', () => {
          const q = mapPopupInput.value.trim();
          const key = q ? regionKeys.find(k => k.includes(q) || q.includes(k)) : null;
          renderPopupChips(key || null);
        });
        mapPopupInput.addEventListener('keydown', (e) => {
          if(e.key==='Enter'){
            const q = mapPopupInput.value.trim();
            if(!q) return;
            const key = regionKeys.find(k => k.includes(q) || q.includes(k));
            if(key){ mapPopup.style.display='none'; focusRegion(key); }
          }
        });
      }
      mapQuery.addEventListener('keydown', (e) => {
        if(e.key==='Enter'){
          const q = mapQuery.value.trim();
          const target = pins.find(p=>p.title.includes(q));
          if(target){
            renderPins(target.title);
            // ê°„ë‹¨íˆ ìŠ¤í¬ë¡¤ í¬ì»¤ì‹± íš¨ê³¼
            const rect = mapCanvas.getBoundingClientRect();
            const cx = rect.left + rect.width * target.x/100;
            const cy = rect.top + rect.height * target.y/100;
            window.scrollTo({ top: Math.max(0, window.scrollY + cy - window.innerHeight/2), behavior: 'smooth' });
          }
        }
      });

      function focusRegion(name){
        // ì§€ì—­ë³„ í•€ ë°ì´í„° ìƒì„±
        const regionalData = {
          'ì„œìš¸': [
            { x: 46, y: 36, title: 'ê²½ë³µê¶', url: 'https://images.unsplash.com/photo-1576010198627-0118b5b6c01c?w=400' },
            { x: 48, y: 34, title: 'ë‚¨ì‚°íƒ€ì›Œ', url: 'https://images.unsplash.com/photo-1571872901437-6e8419c94ad7?w=400' },
            { x: 44, y: 38, title: 'í•œê°•ê³µì›', url: 'https://images.unsplash.com/photo-1516483638261-f4dbaf036963?w=400' },
          ],
          'ë¶€ì‚°': [
            { x: 65, y: 75, title: 'í•´ìš´ëŒ€', url: 'https://images.unsplash.com/photo-1606660585005-8c2f2740d37a?w=400' },
            { x: 63, y: 73, title: 'ê°ì²œë¬¸í™”ë§ˆì„', url: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400' },
            { x: 67, y: 76, title: 'ê´‘ì•ˆë¦¬', url: 'https://images.unsplash.com/photo-1502082553048-f009c37129b9?w=400' },
          ],
          'ì œì£¼': [
            { x: 48, y: 92, title: 'ì„±ì‚°ì¼ì¶œë´‰', url: 'https://images.unsplash.com/photo-1519060825752-c7aaf69de7a7?w=400' },
            { x: 40, y: 90, title: 'í˜‘ì¬í•´ìˆ˜ìš•ì¥', url: 'https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=400' },
            { x: 45, y: 95, title: 'í•œë¼ì‚°', url: 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=400' },
          ],
        };
        // ì§€ì—­ë³„ í•€ìœ¼ë¡œ êµì²´ (ëœë¤ ìœ„ì¹˜)
        if(regionalData[name]){
          pins = regionalData[name].map(spot => ({
            ...spot,
            x: 20 + Math.random() * 60, // 20~80% ë²”ìœ„
            y: 20 + Math.random() * 60, // 20~80% ë²”ìœ„
          }));
        } else {
          pins = [...originalPins];
        }
        renderPins(null);
        renderHotelCards();
      }

      // ì§€ë„ ë“œë˜ê·¸ ê°€ëŠ¥ ë°”í…€ì‹œíŠ¸
      const mapSheet = document.getElementById('map-sheet');
      const mapSheetHandle = document.getElementById('map-sheet-handle');
      const mapSheetList = document.getElementById('map-sheet-list');
      // í¼ì¹˜ê¸° ë²„íŠ¼ ì œê±°ë¨
      let isDragging = false;
      let startY = 0, startHeight = 0, lastY = 0;
      const PEEK_H = 70; // í•˜ë‹¨ë°” ê·¼ì²˜ í•¸ë“¤ë§Œ ë³´ì´ëŠ” ë†’ì´
      const MIN_H = 200;
      function getMaxH(){
        // ê²€ìƒ‰ ì…ë ¥ ë°•ìŠ¤ í•˜ë‹¨ ì§ì „ê¹Œì§€ ì œí•œ
        const search = document.querySelector('.map-search');
        const rect = search ? search.getBoundingClientRect() : { bottom: 110 };
        const stopY = (rect.bottom || 110) + 6;
        return Math.max(MIN_H + 1, Math.floor(window.innerHeight - stopY));
      }
      
      function openSheet(){
        const MAX_H = getMaxH();
        mapSheet.classList.add('open');
        // íƒ„ì„± ì˜¤ë²„ìŠˆíŠ¸: ì‚´ì§ ë„˜ê²¼ë‹¤ê°€ ë³µê·€
        mapSheet.style.height = (MAX_H + 12) + 'px';
        setTimeout(() => { mapSheet.style.height = MAX_H + 'px'; }, 120);
        // í¼ì¹  ë•Œ ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ë¡œ ì´ë™
        const content = mapSheet.querySelector('.content');
        if(content) content.scrollTop = 0;
      }
      function closeSheet(){
        mapSheet.classList.remove('open');
        mapSheet.style.height = MIN_H + 'px';
        
      }
      
      if(mapSheetHandle){
        mapSheetHandle.addEventListener('mousedown', (e) => {
          isDragging = true;
          startY = e.clientY;
          lastY = e.clientY;
          const MAX_H = getMaxH();
          startHeight = mapSheet.classList.contains('open') ? MAX_H : (parseInt(getComputedStyle(mapSheet).height) || MIN_H);
          e.preventDefault();
        });
      }
      document.addEventListener('mousemove', (e) => {
        if(!isDragging) return;
        lastY = e.clientY;
        const dy = startY - e.clientY;
        const MAX_H = getMaxH();
        const newHeight = Math.max(PEEK_H, Math.min(MAX_H, startHeight + dy));
        mapSheet.style.height = newHeight + 'px';
      });
      document.addEventListener('mouseup', () => {
        if(!isDragging) return;
        isDragging = false;
        const dy = startY - lastY;
        const current = parseInt(getComputedStyle(mapSheet).height);
        const MAX_H = getMaxH();
        if(dy > 20){
          // ìœ„ë¡œ ë“œë˜ê·¸: ì‹œì‘ ìœ„ì¹˜ì— ë”°ë¼ ë‹¨ê³„ ìƒìŠ¹
          if(startHeight <= MIN_H - 40){
            // í”¼í¬ì—ì„œ ì˜¬ë¦¬ë©´ ì¤‘ê°„ê¹Œì§€ë§Œ
            mapSheet.style.height = MIN_H + 'px';
          } else {
            openSheet();
          }
          renderHotelCards();
          return;
        }
        // ì•„ë˜ë¡œ ë“œë˜ê·¸: í˜„ì¬ ìœ„ì¹˜ì— ë”°ë¼ MIN -> PEEK ë‘ ë‹¨ê³„ í•˜í–¥
        if(current > MIN_H + 20){
          mapSheet.style.height = MIN_H + 'px';
        } else {
          mapSheet.style.height = PEEK_H + 'px';
        }
        // ì ‘íŒ ìƒíƒœì—ì„œëŠ” ë²„íŠ¼ ì œê±°ë¥¼ ìœ„í•´ ì¬ë Œë”
        renderHotelCards();
      });

      // ì°½ í¬ê¸° ë³€ê²½ ì‹œ ìµœëŒ€ ë†’ì´ ì¬ê³„ì‚°
      window.addEventListener('resize', () => {
        if(mapSheet.classList.contains('open')){
          mapSheet.style.height = getMaxH() + 'px';
        }
      });

      function renderHotelCards(){
        mapSheetList.innerHTML = '';
        const currentH = parseInt(getComputedStyle(mapSheet).height);
        // í•˜ë‹¨(í”¼í¬)ì—ì„œë§Œ ìˆ¨ê¹€, ì¤‘ê°„/ìµœëŒ€ì—ì„œëŠ” ë…¸ì¶œ
        if(currentH <= PEEK_H + 5){
          // í•˜ë‹¨ í”¼í¬ ìƒíƒœ: í° ì—¬ë°±ì„ í‘œí˜„
          const pad = document.createElement('div');
          pad.style.cssText = 'height:20px;background:#fff;';
          mapSheetList.appendChild(pad);
          return;
        }
        if(window.__pinDetail){
          // í”„ë¦¬ë·°(ì¤‘ê°„) + ìƒì„¸(ìµœëŒ€)
          const backWrap = document.createElement('div');
          backWrap.style.cssText='padding:10px 16px; display:flex; justify-content:flex-start;';
          const backBtn = document.createElement('button');
          backBtn.textContent = 'â†';
          backBtn.style.cssText='border:none;background:#fff;border-radius:10px;padding:6px 10px;cursor:pointer;';
          backBtn.addEventListener('click', () => { window.__pinDetail = null; renderHotelCards(); });
          backWrap.appendChild(backBtn);
          mapSheetList.appendChild(backWrap);
          const thumb = document.createElement('div'); thumb.className = 'thumb';
          const im = document.createElement('img'); im.src = window.__pinDetail.url; attachFallback(im); thumb.appendChild(im);
          mapSheetList.appendChild(thumb);
          if(mapSheet.classList.contains('open')){
            const body = document.createElement('div'); body.className='body';
            const title = document.createElement('div'); title.style.cssText='font-size:16px;font-weight:700;'; title.textContent = window.__pinDetail.title || 'ì„ íƒí•œ ì¥ì†Œ';
            body.appendChild(title);
            const chips = document.createElement('div'); chips.className='chips';
            ['#ì—¬í–‰','#ì‚¬ì§„ìŠ¤íŒŸ'].forEach(t=>{ const c=document.createElement('div'); c.className='chip'; c.textContent=t; chips.appendChild(c); });
            body.appendChild(chips);
            const note = document.createElement('div'); note.style.cssText='color:#333;line-height:20px;margin-top:8px;'; note.textContent='ì´ ì§€ì—­ì˜ ë² ìŠ¤íŠ¸ í¬ì¸íŠ¸ë¥¼ ë‹´ì•˜ì–´ìš”.';
            body.appendChild(note);
            mapSheetList.appendChild(body);
          }
        } else {
          // ì½œë¼ì£¼
          const grid = document.createElement('div');
          grid.className = 'collage-grid';
          pins.forEach((pin, idx) => {
            const wrapper = document.createElement('div');
            wrapper.className = 'image-wrapper';
            wrapper.addEventListener('click', () => {
              window.__pinDetail = { url: pin.url, title: pin.title, hashtags: ['#ì—¬í–‰', '#ì‚¬ì§„ìŠ¤íŒŸ'], note: 'ì‚¬ìš©ì ë…¸íŠ¸ì…ë‹ˆë‹¤.' };
              openSheet();
              renderHotelCards();
            });
            const img = document.createElement('img');
            img.src = pin.url;
            img.alt = pin.title;
            attachFallback(img);
            wrapper.appendChild(img);
            grid.appendChild(wrapper);
          });
          mapSheetList.appendChild(grid);
        }

        // ì§€ë„ë³´ê¸° ë²„íŠ¼ - ìŠ¤í¬ë¡¤ ë (í¼ì¹œ ìƒíƒœì—ì„œë§Œ ë³´ì„)
        if(mapSheet.classList.contains('open')){
          const btnWrapper = document.createElement('div');
          btnWrapper.style.cssText = 'padding:30px 20px;text-align:center;';
          const btn = document.createElement('button');
          btn.textContent = 'ì§€ë„ë³´ê¸°';
          btn.style.cssText = 'background:#FF7A1A;color:#fff;border:none;border-radius:25px;padding:12px 60px;font-size:16px;font-weight:600;cursor:pointer;';
          btn.addEventListener('click', () => {
            closeSheet();
            window.__pinDetail = null;
            pins = [...originalPins];
            renderPins(null);
            renderHotelCards();
          });
          btnWrapper.appendChild(btn);
          mapSheetList.appendChild(btnWrapper);
        }
      }
      renderHotelCards();
      
      // ë²„íŠ¼ ì—†ìŒ: ë“œë˜ê·¸ë§Œ ì‚¬ìš©

      // í”„ë¡œí•„ ë±ƒì§€
      const badgeWrap = document.getElementById('profile-badges');
      if(badgeWrap){
        const badges = [
          { id: 'local', label: 'ì§€ì—­ í˜„ì§€ì¸', color: '#4CAF50' },
          { id: 'traveler', label: 'ì—¬í–‰ê´‘', color: '#FF7A1A' },
          { id: 'eastwest', label: 'ë™í•´ë²ˆì© ì„œí•´ë²ˆì©', color: '#3B82F6' },
          { id: 'walker', label: 'ê±·ê¸°ëŸ¬ë²„', color: '#8B5CF6' },
          { id: 'foodie', label: 'ë§›ì§‘í—Œí„°', color: '#EF4444' },
        ];
        badges.forEach(b => {
          const chip = document.createElement('div');
          chip.className = 'chip';
          chip.style.display = 'inline-flex';
          chip.style.alignItems = 'center';
          chip.style.gap = '8px';
          const dot = document.createElement('span');
          dot.style.cssText = `width:8px;height:8px;border-radius:4px;background:${b.color};display:inline-block;`;
          const text = document.createElement('span');
          text.textContent = b.label;
          chip.appendChild(dot); chip.appendChild(text);
          chip.addEventListener('click', () => openRegion(b.label));
          badgeWrap.appendChild(chip);
        });
      }

      // í”„ë¡œí•„ ê·¸ë¦¬ë“œ ìƒ˜í”Œ ì´ë¯¸ì „ì „
      const profileGrid = document.getElementById('profile-grid');
      const profileImgs = Array.from({ length: 12 }, (_, i) => `https://source.unsplash.com/random/600x600?sig=${i+1}&travel`);
      profileImgs.forEach(src => {
        const cell = document.createElement('div');
        cell.className = 'cell';
        const im = document.createElement('img'); im.src = src; attachFallback(im); cell.appendChild(im);
        profileGrid.appendChild(cell);
      });

      // í”„ë¡œí•„ ê·¸ë¦¬ë“œ í´ë¦­ ì‹œ ì‚¬ì§„ ìƒì„¸ë¡œ ì´ë™
      profileGrid.addEventListener('click', (e) => {
        const img = e.target.closest('img');
        if(!img) return;
        openPhotoDetail({ url: img.getAttribute('src'), location: 'ë‚´ ê°¤ëŸ¬ë¦¬', tags: ['#ë‚´ì‚¬ì§„'], note: 'ë‚´ í”„ë¡œí•„ì—ì„œ ì˜¬ë¦° ì‚¬ì§„ì…ë‹ˆë‹¤.' });
      });

      document.addEventListener('scroll', () => {
        if(!screens.trending.classList.contains('active')) return;
        const nearBottom = window.innerHeight + window.scrollY >= document.body.scrollHeight - 200;
        if(nearBottom){ addItems(12); }
      });
    </script>
</body>
</html>

